import requests
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler
from bs4 import BeautifulSoup

# 토큰과 그룹 ID를 설정합니다.
TOKEN = "7412076033:AAE8aiINodpNSyWkguzXYrwtEpQ881hSK0o"
GROUP_ID = -1001821958950

# URL 설정
DEXSCREENER_URL = "https://dexscreener.com/solana/5fuyozga5rbyhcl4is7hdeusvxvzkn81hc8vwwut9g5g"

def fetch_coin_data():
    # 웹페이지를 요청하고 BeautifulSoup을 사용하여 파싱합니다.
    response = requests.get(DEXSCREENER_URL)
    soup = BeautifulSoup(response.text, 'html.parser')
    
    # 코인 이름과 시세 정보를 가져옵니다.
    # 실제 페이지에서 해당 정보를 추출해야 합니다. 아래는 예시입니다.
    
    # 예시: 코인 이름 추출
    coin_name_tag = soup.find("div", class_="css-1m1f8hn")  # 실제 클래스를 확인해야 함
    coin_name = coin_name_tag.text if coin_name_tag else "Unknown Coin"
    
    # 예시: 코인 시세 추출
    price_tag = soup.find("div", class_="price")  # 실제 클래스를 확인해야 함
    price = price_tag.text if price_tag else "N/A"
    
    return coin_name, price

async def start(update: Update, context):
    # 실시간 시세와 코인 이름을 가져옵니다.
    coin_name, price = fetch_coin_data()
    
    # 채팅 시작 명령어를 처리하는 핸들러입니다.
    keyboard = [
        [InlineKeyboardButton("SITE", url="https://meme-lump.xyz")],
        [InlineKeyboardButton("SOLSCAN", url="https://solscan.io/token/5fUYozGa5rByHCL4iS7hDEusVXvzkN81hc8VwwuT9G5g")],
        [InlineKeyboardButton("BUY", url=DEXSCREENER_URL)]
    ]

    reply_markup = InlineKeyboardMarkup(keyboard)
    await update.message.reply_text(f"{coin_name} 현재 시세: {price}\n원하는 버튼을 선택하세요:", reply_markup=reply_markup)

def main():
    # ApplicationBuilder를 사용하여 봇을 설정합니다.
    application = Application.builder().token(TOKEN).build()

    # /start 명령어에 대해 핸들러를 설정합니다.
    application.add_handler(CommandHandler("start", start))

    # 봇을 실행합니다.
    application.run_polling()

if __name__ == "__main__":
    main()

import requests
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler
from bs4 import BeautifulSoup

# 토큰과 그룹 ID를 설정합니다.
TOKEN = "7412076033:AAE8aiINodpNSyWkguzXYrwtEpQ881hSK0o"
GROUP_IDS = [-1001821958950, -1002152574020]  # 여러 그룹 ID를 리스트로 저장

# URL 설정
DEXSCREENER_URL = "https://dexscreener.com/solana/5fuyozga5rbyhcl4is7hdeusvxvzkn81hc8vwwut9g5g"

def fetch_coin_data():
    # 웹페이지를 요청하고 BeautifulSoup을 사용하여 파싱합니다.
    response = requests.get(DEXSCREENER_URL)
    soup = BeautifulSoup(response.text, 'html.parser')
    
    # 코인 이름과 시세 정보를 가져옵니다.
    coin_name_tag = soup.find("div", class_="css-1m1f8hn")  # 실제 클래스를 확인해야 함
    coin_name = coin_name_tag.text if coin_name_tag else "Unknown Coin"
    
    price_tag = soup.find("div", class_="price")  # 실제 클래스를 확인해야 함
    price = price_tag.text if price_tag else "N/A"
    
    return coin_name, price

async def send_coin_info(update: Update, context):
    # 실시간 시세와 코인 이름을 가져옵니다.
    coin_name, price = fetch_coin_data()
    
    keyboard = [
        [InlineKeyboardButton("SITE", url="https://meme-lump.xyz")],
        [InlineKeyboardButton("SOLSCAN", url="https://solscan.io/token/5fUYozGa5rByHCL4iS7hDEusVXvzkN81hc8VwwuT9G5g")],
        [InlineKeyboardButton("BUY", url=DEXSCREENER_URL)]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    # 모든 그룹에 메시지를 전송합니다.
    for group_id in GROUP_IDS:
        await context.bot.send_message(chat_id=group_id, text=f"{coin_name} 현재 시세: {price}\n원하는 버튼을 선택하세요:", reply_markup=reply_markup)

def main():
    # Application을 설정합니다.
    application = Application.builder().token(TOKEN).build()

    # /CLARK 명령어에 대해 핸들러를 설정합니다.
    application.add_handler(CommandHandler("CLARK", send_coin_info))

    # 봇을 실행합니다.
    application.run_polling()

if __name__ == "__main__":
    main()
